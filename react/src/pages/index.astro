---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { FilterableMemeGrid } from "../components/FilterableMemeGrid";

const allMemes = await getCollection("memes");

// Sort by date descending (LIFO - Newest Top)
const sortedMemes = allMemes.sort(
	(a, b) =>
		new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
);

// Group by date string
const groupedMemes = sortedMemes.reduce(
	(acc, meme) => {
		const date = meme.data.pubDate;
		if (!acc[date]) acc[date] = [];
		acc[date].push(meme);
		return acc;
	},
	{} as Record<string, typeof allMemes>,
);

// Get sorted date keys (descending)
const sortedDates = Object.keys(groupedMemes).sort(
	(a, b) => new Date(b).getTime() - new Date(a).getTime(),
);
---

<BaseLayout title="Home">
	<!-- Hero Section -->
	<header class="max-w-7xl mx-auto px-6 pt-32 pb-32">
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
			<div class="reveal-item">
				<div
					class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-[10px] font-bold uppercase tracking-widest mb-8"
				>
					<span class="relative flex h-2 w-2">
						<span
							class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"
						></span>
						<span
							class="relative inline-flex rounded-full h-2 w-2 bg-primary"
						></span>
					</span>
					Now Curating: {allMemes.length} Artifacts
				</div>

				<!-- <h1 class="font-display text-6xl md:text-8xl lg:text-[10rem] font-bold leading-[0.85] tracking-tighter uppercase mb-12">
					Dev <br/> <span class="text-primary italic">Culture</span> <br/> Museum
				</h1>
				
				<p class="text-muted-foreground text-lg md:text-xl font-medium leading-relaxed max-w-lg mb-12">
					Uma coleção curada de piadas internas, erros de sintaxe e o caos do desenvolvimento moderno transformado em patrimônio digital.
				</p>

				<div class="flex flex-col sm:flex-row gap-4">
					<button class="bg-primary text-white font-bold py-5 px-10 uppercase tracking-widest text-xs hover:bg-primary/90 transition-all flex items-center justify-center gap-2">
						Explorar Acervo
						<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
						</svg>
					</button>
					<button class="border border-border font-bold py-5 px-10 uppercase tracking-widest text-xs hover:border-primary hover:text-primary transition-all">
						Ver Categorias
					</button>
				</div> -->
			</div>

			<!-- <div
				class="hidden lg:block relative reveal-item"
				style="animation-delay: 0.2s"
			> -->
			<!-- <div
					class="aspect-square bg-muted border-2 border-primary/20 relative overflow-hidden group"
				> -->
			<!-- <div
						class="absolute inset-0 bg-primary/5 group-hover:bg-primary/10 transition-colors"
					>
					</div>
					<div
						class="absolute inset-0 flex items-center justify-center"
					>
						<span
							class="font-display text-[20rem] font-bold text-primary/5 select-none"
							>BUG</span
						>
					</div> -->
			<!-- Decorative Grid -->
			<!-- <div
						class="absolute inset-0"
						style="background-image: radial-gradient(circle at 1px 1px, rgba(59, 130, 246, 0.1) 1px, transparent 0); background-size: 40px 40px;"
					>
					</div> -->
			<!-- </div> -->
			<!-- Floating Badges -->
			<!-- <div
					class="absolute -top-8 -right-8 w-32 h-32 bg-accent rotate-12 flex items-center justify-center shadow-2xl"
				>
					<span
						class="text-white font-bold text-center leading-tight uppercase tracking-tighter text-xl"
						>100%<br />Meme</span
					>
				</div> -->
			<!-- </div> -->
		</div>
	</header>

	<!-- Main Grid -->
	<section class="max-w-7xl mx-auto px-6 pb-48">
		<FilterableMemeGrid
			client:load
			groupedMemes={groupedMemes}
			sortedDates={sortedDates}
		/>
	</section>
</BaseLayout>
